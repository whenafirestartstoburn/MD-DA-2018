---
title: "lw2"
author: "disclosure fan"
date: '11th October, 2018'
output: html_document
---

Установленная среда R включает в себя набор заранее сконфигурированных массивов данных. В данной лабораторной требуется использовать одну из них — датафрейм из 93 машин-новинок 1993 года. Для того, чтобы загрузить данный датафрейм, необходимо выполнить следующие команды:

library(MASS)
data(Cars93)
Для того, чтобы ознакомиться со структурой и составом данных, можно выполнить команду View(Cars93) или нажать на соответствующую кнопку в RStudio.

```{r}
library(MASS)
data(Cars93)
```


# Задание 1

- Выполните команду summary() на полном наборе данных. Можно ли по результату выполнения сказать сколько строк в датафрейме? Если да, напишите сколько. Если нет, то приведите другой способ

```{r}
Cars93Summary <- summary(Cars93)
nrow(Cars93Summary) # Данный способ не работает, возвращает 7 строк, хотя там их 93
nrow(Cars93) # Данный способ работает, возвращается реальное значение в 93 строки
```

- Найдите среднюю цену машин с задним приводом.

```{r}
avgFrontDriveTrainCarsPrice <- mean(Cars93$Price[Cars93$DriveTrain == 'Front']) # 17.53582
```

- Найдите минимальное число лошадиных сил автомобиля для 7 пассажиров. Для 6 пассажиров.

```{r}
minHPFor7Passengers <- min(Cars93$Horsepower[Cars93$Passengers == 7]) # 109 л.с.
minHPFor7Passengers <- min(Cars93$Horsepower[Cars93$Passengers == 6]) # 100 л.с.
```

- Найдите машины с максимальным, минимальным и средним(медианой) расстоянием, которая машина может проехать по трассе. Вам понадобятся 2 колонки, чтобы рассчитать расстояние. Какие?

```{r}
# Понядобятся колонки MPG.Highway и Fuel.tank.capacity

Cars93$HighwayDistance = Cars93$MPG.highway*Cars93$Fuel.tank.capacity

Cars93$Make[which.min(Cars93$HighwayDistance)]# MercuryCapry
Cars93$Make[which.max(Cars93$HighwayDistance)]# BMW 535i
Cars93$Make[which(Cars93$HighwayDistance == median(Cars93$HighwayDistance))]# Mazda MPV

```


# Задание 2

- В самом начале занятий приводился пример с фабрикой и производством автомобилей. Ниже приведён пример кода, который старается оптимизировать выпуск продукции ориентируясь на доступные ресурсы.

```{r eval=FALSE}
factory.run <- function (o.cars=1, o.trucks=1) {
  factory <- matrix(c(40,1,60,3),nrow=2, dimnames=list(c("трудодни","сталь"),c("автомобили","грузовики")))
  warehouse <- c(1600,70) #Доступно материалов на складе
  names(warehouse) <- rownames(factory)
  reserve <- c(8,1)
  names(reserve) <- rownames(factory)
  output <- c(o.cars, o.trucks)
  names(output) <- colnames(factory)
  
  steps <- 0 # Счётчик числа шагов цикла
  repeat {
    steps <- steps + 1
    needed <- factory %*% output # Подсчитаем ресурсы, которые нам нужны для производства требуемого кол-ва машин
    message(steps)
    print(needed)
    # Если ресурсов достаточно и остаток меньше или равен резерву, то мы произвели максимум возможного.
    # Нужно прекращать
    if (all(needed <= warehouse) && all((warehouse - needed) <= reserve)) {
      break()
    }
    # Если заявка слишком большая и ресурсов недостаточно, уменьшим её на 10%
    if (all(needed > warehouse)) {
      output <- output * 0.9
      next()
    }
    # Если всё наоброт, то увеличим на 10%
    if (all(needed < warehouse)) {
      output <- output * 1.1
      next()
    }
    # Если мы потребили одного ресурса слишком много, а другого недостаточно,
    # то увеличим план на случайную величину
    output <- output * (1+runif(length(output),min=-0.1,max=0.1))
  }
  
  return(output)
}

factory.run() # вызов функции
```

- С каким входными значениями функция вызвана? Какой получился результат?

Функция вызвана со значениями (o.cars=1, o.trucks=1)
В результате за 1597 трудодней изготовлено 10 автомобилей и 19 грузовиков.

- Повторите вызов 4 раза. Полученные ответы отличаются от полученных ранее? Если да, почему? Если нет, почему?

```{r eval=FALSE}
factory.run()
factory.run() 
factory.run() 
factory.run()
```

Ответы получаются разные т.к. в строке:

output <- output * (1+runif(length(output),min=-0.1,max=0.1))

план увеличивается на случайную величину.

- В приведённом коде, переменные steps и output находятся внутри алгоритма. Измените функцию так, чтобы она возвращала число шагов и произведённое количество машин.

```{r eval=FALSE}
factory.run <- function (o.cars=1, o.trucks=1) {
  factory <- matrix(c(40,1,60,3),nrow=2, dimnames=list(c("трудодни","сталь"),c("автомобили","грузовики")))
  warehouse <- c(1600,70) #Доступно материалов на складе
  names(warehouse) <- rownames(factory)
  reserve <- c(8,1)
  names(reserve) <- rownames(factory)
  output <- c(o.cars, o.trucks)
  names(output) <- colnames(factory)
  
  steps <- 0 # Счётчик числа шагов цикла
  repeat {
    steps <- steps + 1
    needed <- factory %*% output # Подсчитаем ресурсы, которые нам нужны для производства требуемого кол-ва машин
    message(steps)
    print(needed)
    # Если ресурсов достаточно и остаток меньше или равен резерву, то мы произвели максимум возможного.
    # Нужно прекращать
    if (all(needed <= warehouse) && all((warehouse - needed) <= reserve)) {
      break()
    }
    # Если заявка слишком большая и ресурсов недостаточно, уменьшим её на 10%
    if (all(needed > warehouse)) {
      output <- output * 0.9
      next()
    }
    # Если всё наоброт, то увеличим на 10%
    if (all(needed < warehouse)) {
      output <- output * 1.1
      next()
    }
    # Если мы потребили одного ресурса слишком много, а другого недостаточно,
    # то увеличим план на случайную величину
    output <- output * (1+runif(length(output),min=-0.1,max=0.1))
  }
  
  factoryWork <- c(steps, output)
  
  return(factoryWork)
}

factoryWork <- factory.run(o.cars = 30, o.trucks = 20)
```

Какой получили результат?

1594 Трудодней
69 стали
10 автомобилей
19 грузовиков

Как много итераций пришлось пройти, чтобы получить ответ (переменная steps)?

6239 итераций
